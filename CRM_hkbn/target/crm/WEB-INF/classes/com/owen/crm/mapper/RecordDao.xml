<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.owen.crm.mapper.RecordDao">
    <select id="getRecordByCustomer" parameterType="QueryVo" resultType="Record">
        select hr.inTime, hr.outTime, hr.breakfast, hr.price, h.roomNumber from
        hotel_record as hr inner join hotel as h on customerId = #{id} and hr.roomId = h.id
        limit #{startRow},#{size}
    </select>

    <select id="countRecordByCustomer" parameterType="Integer" resultType="Integer">
        select count(1) from hotel_record where customerId = #{id}
    </select>

    <!-- 总条数 -->
    <select id="recordCountByQueryVo" parameterType="QueryVo"
            resultType="Integer">
        select count(1) from ((hotel_record as hr left join hotel_customer as hc on
        hr.customerId = hc.id
        ) left join hotel as h on hr.roomId = h.id)
        <where>
            <if test="roomNumber != null and roomNumber != ''">
                h.roomNumber = #{roomNumber}
            </if>
            <if test="type != null and type != ''">
                and h.`type` like "%"#{type}"%"
            </if>
            <if test="name != null and name != ''">
                and hc.`name` like "%"#{name}"%"
            </if>
        </where>
    </select>

    <!-- 结果集 -->
    <select id="selectRecordListByQueryVo" parameterType="QueryVo"
            resultType="QueryVo">
        select
        hr.id as id,
        hc.name as name,
        hc.telephone as telephone,
        h.roomNumber as roomNumber,
        h.type as `type`,
        hr.inTime as inTime,
        hr.outTime as outTime
        from ((hotel_record as hr left join hotel_customer as hc on
        hr.customerId = hc.id
        ) left join hotel as h on hr.roomId = h.id)
        <where>
            <if test="roomNumber != null and roomNumber != ''">
                h.roomNumber = #{roomNumber}
            </if>
            <if test="type != null and type != ''">
                and h.`type` like "%"#{type}"%"
            </if>
            <if test="name != null and name != ''">
                and hc.`name` like "%"#{name}"%"
            </if>
        </where>
        order by id desc
        limit #{startRow}, #{size}
    </select>

    <select id="getRecordByRoomNumber" parameterType="Integer" resultType="QueryVo">
        select hr.*, h.roomNumber as roomNumber, hc.name as name, h.type as `type`
        from ((hotel_record as hr inner  join  hotel as h on h.roomNumber = #{roomNumber} and h.id = hr.roomId
        inner join hotel_customer as hc on hr.customerId = hc.id));
    </select>

</mapper>